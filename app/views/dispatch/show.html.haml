= render partial: 'dispatch/modal'

= render partial: 'dispatch/nav'

/ .disp-server-status
/   Connecting

.row
  .col-md-7

    .dispatch-filters
      = link_to 'All', '#', onclick: 'javascript: dispatchController.showAllConversations(); return false;', id: 'conv-all'
      &nbsp; · &nbsp;

      = link_to 'Needs Help', '#', onclick: 'javascript: dispatchController.showStatusConversations("need_help"); return false;', id: 'conv-help'
      &nbsp; · &nbsp;

      = link_to 'In Progress', '#', onclick: 'javascript: dispatchController.showStatusConversations("in_progress"); return false;', id: 'conv-prog'
      &nbsp; · &nbsp;

      = link_to 'Stale', '#', onclick: 'javascript: dispatchController.showStaleConversations(); return false;', id: 'conv-stale'

    %table.table.admin{id: 'conversations'}
      %thead
        %tr
          %th{style: 'width:3%'}
          %th{style: 'width:15%'} Voter
          %th{style: 'width:60%'} Last message
          %th{style: 'width:12%'} Status
          %th{style: 'width:10%'} Desired pickup

  .col-md-5{style: 'margin-top: 15px;'}
    #dispatch-map

:javascript

  #{render partial: 'dispatch/init.js'}

  jQuery(document).ready(function($) {
    jQuery.timeago.settings.allowFuture = true;
    $(document).on("click", '.clickable', function(event) {
      $(".modal-body").modal();
      dispatchController.loadRidePane($(this).data("cid"));
      dispatchController.loadConversationMessages($(this).data("cid"));
    });

    // something's fucked with bootstrap, so make sure we clean up half-closed modals ourselves
    $('#conv-modal').on('hidden.bs.modal', function () {
      $('body').removeClass('modal-open');
      $('.modal-backdrop').remove();
    });
  });

