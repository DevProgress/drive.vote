:css
  h4, h6 { margin-top: 30px; }

:javascript
  function send_reply(url) {
    var args = {'message' : {'body': $('#body').val()}};
    $.ajax(url, {type: 'POST', dataType: 'json', data: args, process_data: false, content_type: 'application/json'})
      .success(function() { location.reload(); });
  }

= render 'admin/nav', {active: 'conversations'}

%h4
  Conversation #{@conversation.id}
= render partial: 'admin/conversations/table', locals: {conversations: [@conversation], include_show: false}

%h4
  Messages

%table.admin
  %thead
    %tr
      %th Time
      %th Sent By
      %th Message

  %tbody
    - @conversation.messages.order('created_at asc').each do |message|
      %tr
        %td= message.created_at.localtime.strftime('%m/%d %l:%M%P')

        %td
          - if message.from.phony_formatted == @conversation.from_phone.phony_formatted
            Voter
          - else
            Dispatcher

        %td= message.body

%h6
  Reply
= text_area_tag 'body', nil, rows: 3, cols: 60

%p
  = button_tag 'Send', type: :submit, class: 'btn btn-primary', disable_with: "Replying...", onclick: "javascript: send_reply('#{messages_api_v1_conversation_path(@conversation)}')"
