<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8" />
	<title>Dispatch Map</title>
	<link rel="stylesheet" href="https://writ.cmcenroe.me/1.0.3/writ.min.css">
	<script src="Map.js"></script>
	<script src="DispatcherView.js"></script>
    <style>
      body {
        width: 80%;
        margin: 2em;
      }
      #gmap, #lmap {
        height: 500px;
        margin: 1em 0;
      }
    </style>
</head>
<body>
    <h1>Dispatch Map</h1>
    <div id="gmap"></div>
    <p>
        Sample dispatcher view with rides and drivers,
        <a href="https://github.com/john/drive.vote/issues/80">described in issue #80</a>.
    </p>
    <script>
    
        function on_loaded(map)
        {
            // right now
            var start = (new Date()).getTime() / 1000;

            // Set a driver and two rides.
            view.setDriver({id: 1234, latitude: 37.771612, longitude: -122.426836, name: 'Joe Driver'});
            view.setRide({id: 2345, from_latitude: 37.770444, from_longitude: -122.434960, name: 'Voter Jim', status: 'waiting_assignment', pickup_time: start + 601});
            view.setRide({id: 3456, from_latitude: 37.769079, from_longitude: -122.433674, name: 'Voter Jane', status: 'waiting_assignment', pickup_time: start + 601});

            window.setTimeout(function() {
                // Update the driver and both rides.
                // Note how the first ride is part of the driver here.
                view.setDriver({id: 1234, latitude: 37.771455, longitude: -122.428098, name: 'Joe Driver',
                                active_ride: {id: 2345, from_latitude: 37.770709, from_longitude: -122.435082, name: 'Voter Jim', status: 'driver_assigned', pickup_time: start + 601}});
                
                // Jane's pickup time is in less than ten minutes, but she has no driver.
                view.setRide({id: 3456, from_latitude: 37.768962, from_longitude: -122.433387, name: 'Voter Jane', status: 'waiting_assignment', pickup_time: start + 601});
                }, 3000);
        }

        var gmap = new Map(document.getElementById('gmap'), on_loaded,
                           {'google_api_key': 'AIzaSyDyJ3LTbJGAEIKjqYj3-gFDbAZ3BLo6sGo',
                            lat: 37.77073, lon: -122.43020, zoom: 16});

        var view = new DispatcherView(gmap);
        
        // This should fail, because the map is not yet expected to have been initialized.
        view.setDriver({id: 7890, latitude: 37.771612, longitude: -122.426836, name: 'Joe Earlybird'});

    </script>
</body>
</html>
